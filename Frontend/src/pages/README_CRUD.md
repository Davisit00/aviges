# CRUD Pages Architecture

## Overview

Each CRUD page is now a **self-contained module** with its own logic. There is no shared base class or framework - each page is independent and can be customized freely.

## Template File

Use `productos_example.js` as your template when creating new CRUD pages.

## Creating a New CRUD Page

1. **Copy the template**:
   ```bash
   cp productos_example.js your_resource.js
   ```

2. **Update the configuration section**:
   ```javascript
   const RESOURCE_NAME = 'your_resource';  // API endpoint name
   const DISPLAY_NAME = 'Tu Recurso';      // Display name in Spanish
   
   const FIELDS = [
       { name: 'field1', label: 'Campo 1', type: 'text', required: true },
       { name: 'field2', label: 'Campo 2', type: 'number', required: false },
       // Add all fields for your resource
   ];
   ```

3. **Customize the table columns** (in `renderTable()`):
   ```javascript
   tr.innerHTML = `
       <td>${item.id}</td>
       <td>${item.field1}</td>
       <td>${item.field2}</td>
       <td><!-- Action buttons --></td>
   `;
   ```

4. **Update function and ID names**:
   - Replace `ProductosInterface` with `YourResourceInterface`
   - Replace `productosTable` with `yourResourceTable`
   - Update all IDs to match your resource name

5. **Export your interface**:
   ```javascript
   export function YourResourceInterface() {
       // ... your code
   }
   ```

## Structure of Each CRUD Page

Each page file contains these sections:

### 1. Configuration
- Resource name and display name
- Field definitions

### 2. State Management
- Current data array
- Pagination state
- Editing state

### 3. Data Loading
- `loadData()` - Fetch data from API

### 4. CRUD Operations
- `handleCreate()` - Create new record
- `handleUpdate()` - Update existing record
- `handleDelete()` - Delete record

### 5. UI Rendering
- `renderTable()` - Render data table
- `renderPagination()` - Render pagination controls
- `renderForm()` - Render create/edit form
- `openCreateModal()` / `openEditModal()` / `closeModal()`

### 6. Event Handlers
- `handleFormSubmit()` - Process form submission

### 7. Initialization
- Main interface function that returns the container
- Sets up all event listeners
- Checks permissions
- Loads initial data

## Field Types

Common field types you can use:

```javascript
{ name: 'text_field', label: 'Text', type: 'text', required: true }
{ name: 'number_field', label: 'Number', type: 'number', required: true }
{ name: 'email_field', label: 'Email', type: 'email', required: false }
{ name: 'auto_field', label: 'Auto', type: 'text', autoGenerated: true }
```

For select dropdowns and foreign keys, you'll need to customize the `renderForm()` function.

## Permissions

The template includes basic permission checking:

```javascript
const permissions = checkPermission(RESOURCE_NAME);
if (!permissions.canCreate) {
    btnNew.style.display = 'none';
}
```

For resources that require admin validation on edit, the `handleUpdate()` function includes a check.

## Customization Examples

### Custom Validation
```javascript
async function handleCreate(formData) {
    // Add custom validation
    if (formData.nombre.length < 3) {
        showMessage('El nombre debe tener al menos 3 caracteres', 'error');
        return;
    }
    
    // Continue with creation...
}
```

### Custom Table Rendering
```javascript
function renderTable() {
    // ... get tbody ...
    
    currentData.forEach(item => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td>${item.id}</td>
            <td><strong>${item.nombre}</strong></td>
            <td class="${item.active ? 'active' : 'inactive'}">${item.status}</td>
            <td><!-- buttons --></td>
        `;
        tbody.appendChild(tr);
    });
}
```

### Foreign Key Fields
```javascript
// In renderForm(), for a foreign key field:
const select = document.createElement('select');
select.name = 'id_related';
select.required = true;

// Load related data
const relatedData = await listResource('related_resource');
relatedData.items.forEach(item => {
    const option = document.createElement('option');
    option.value = item.id;
    option.textContent = item.nombre;
    select.appendChild(option);
});

div.appendChild(select);
```

## Benefits of This Approach

✅ **Simple**: Each file is self-contained and easy to understand
✅ **Flexible**: Customize anything without worrying about breaking other pages
✅ **Maintainable**: Changes to one resource don't affect others
✅ **No Magic**: No hidden framework behavior - everything is explicit
✅ **Easy to Debug**: All logic for a resource is in one file

## Migration from Old Pages

For existing pages using `resourceCrud.js`:

1. Keep them as-is for now (they still work)
2. When you need to customize a page, copy `productos_example.js`
3. Adapt it to your resource's needs
4. Replace the old page with your new implementation

## Questions?

Refer to `productos_example.js` for a complete working example with comments explaining each section.
